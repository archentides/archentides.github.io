<!doctype html>
<html ng-app="dnd">
    <head>
        <title>ARCHENTIDES</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
        <meta name="viewport" content="initial-scale=0.3, width=device-width" />
        <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700' rel='stylesheet' type='text/css'>
        <link rel='stylesheet' type='text/css' href='site.css'>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-sanitize.min.js"></script>
        <script type="text/javascript" src="archentides-data.js"></script>

        <script>
            var app = angular.module('dnd', []);

            app.controller('Main', function ($scope, $sce, $timeout) {
                $scope.data = archentidesData;
                $scope.curSessionIndex = 0;
                $scope.curSession = $scope.data.sessions[$scope.curSessionIndex];
                $scope.bgSteps = $.merge([], $scope.curSession.steps);
                $scope.steps = $.merge([], $scope.curSession.steps);
                $scope.showOverlay = false;

                for (var i = 0; i < $scope.bgSteps.length; i++) {
                    $scope.bgSteps[i].index = i;
                }

                for (var i = 0; i < $scope.data.sessions.length; i++) {
                    var session = $scope.data.sessions[i];

                    for (var j = 0; j < session.steps.length; j++) {
                        var step = session.steps[j];
                        step.copy = $sce.trustAsHtml(step.copy);
                    }
                }

                $scope.curStep = 0;
                setStep(true);

                $scope.prevStep = function () {
                    $scope.curStep = ($scope.curStep + $scope.curSession.steps.length - 1) % $scope.curSession.steps.length;
                    setStep();
                };
                $scope.nextStep = function () {
                    $scope.curStep = ($scope.curStep + 1) % $scope.curSession.steps.length;
                    setStep();
                };

                $scope.toggleOverlay = function () {
                    $scope.showOverlay = !$scope.showOverlay;
                };

                function setStep (initial) {
                    var index = 0;

                    // find current step, move to end of array
                    for (var i = 0; i < $scope.bgSteps.length; i++) {
                        $scope.bgSteps[i].preshow = false;
                        $scope.bgSteps[i].show = false;

                        if ($scope.bgSteps[i].index === $scope.curStep) {
                            index = i;
                        }
                    }

                    var step = $scope.bgSteps[index];
                    step.preshow = !initial;
                    $scope.bgSteps.splice(index, 1);
                    $scope.bgSteps.push(step);

                    $timeout(function () {
                        step.preshow = false;
                        step.show = true;
                    });
                }

                $scope.overlay = function (id) {
                    $scope.showOverlay = true;
                };
            });
        </script>
    </head>

    <body ng-controller="Main">
        <div class="header" ng-click="toggleOverlay()">
            <div class="logo">
                <div class="vhelper"></div>
                <img class="normal" src="images/ArchentidesSmall.png" alt=""/>
                <img class="hover" src="images/ArchentidesSmallHover.png" alt=""/>
            </div>

            <div class="nav">
                <div class="button current">Story</div>
                <div class="button">Players</div>
                <div class="button">Rules</div>
            </div>

            <div class="arrows">
                <div class="arrow" ng-click="prevStep()">
                    <div class="vhelper"></div>
                    <img class="normal" src="images/ArrowLeft.png" alt=""/>
                    <img class="hover" src="images/ArrowLeftHover.png" alt=""/>
                </div>
                <div class="arrow" ng-click="nextStep()">
                    <div class="vhelper"></div>
                    <img class="normal" src="images/ArrowRight.png" alt=""/>
                    <img class="hover" src="images/ArrowRightHover.png" alt=""/>
                </div>
            </div>
        </div>

        <div class="bg" ng-class="{preshow:step.preshow,show:step.show}" ng-style="{background: step.bg}" ng-repeat="step in bgSteps">
            <img ng-src="images/Map_{{step.image}}.png" src="" alt="" />
        </div>

        <div class="tile" ng-class="{show:step.show||step.preshow}" ng-repeat="step in steps">
            <div class="content">
                <div class="title">{{curSession.title}}</div>
                <div class="subtitle">{{curSession.subtitle}}</div>
                <div class="copy-title">{{step.copyTitle}}</div>
                <div class="copy" ng-bind-html="step.copy"></div>
                <div class="button-row">
                    <div class="left" ng-class="{inactive:$first}" ng-click="!$first&&prevStep()">Back</div>
                    <div class="right" ng-click="nextStep()">Next</div>
                    {{$index+1}} of {{steps.length}}
                </div>
            </div>
        </div>

        <div class="curtain" ng-show="showOverlay" ng-click="showOverlay=false;"></div>

        <div class="overlay-wrapper" ng-show="showOverlay" ng-click="showOverlay=false;">
            <div class="overlay">
                <div class="title">Golden Tablet</div>
                <div class="copy">A plate of gold alloy roughly six inches wide by eight inches tall and 1/3” thick. It weighs about ten pounds. One side is etched with a demonic scene (below) with a decorated keyhole offset from center. There is no actual hole where the keyhole looks to be. The reverse side of the plate is flat and plain with no markings.</div>
                <div class="group">
                    <img class="right" src="images/Diamond.jpg" alt="" />
                    <div class="copy">
                        Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy
                        <a href="#">nibh </a>
                        euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.</div>
                </div>
                <img class="left" src="images/Diamond.jpg" alt="" />
                <div class="copy">Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.</div>
            </div>
        </div>
    </body>
</html>